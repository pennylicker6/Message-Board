<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Retro Message Board</title>
  <style>
    body {
      background: black;
      color: #33ff33;
      font-family: 'Courier New', monospace;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      text-shadow: 0 0 5px #00ff00;
    }
    #inputArea {
      text-align: center;
      margin-bottom: 1rem;
    }
    input[type="text"] {
      width: 60%;
      padding: 0.5rem;
      background: #111;
      color: #33ff33;
      border: 1px solid #33ff33;
    }
    button {
      background: #111;
      color: #33ff33;
      border: 1px solid #33ff33;
      padding: 0.5rem 1rem;
      margin-left: 0.5rem;
      cursor: pointer;
    }
    button:hover {
      background: #33ff33;
      color: black;
    }
    #messages {
      margin-top: 2rem;
      border-top: 1px solid #33ff33;
      padding-top: 1rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .message {
      margin-bottom: 1rem;
      border-bottom: 1px dashed #33ff33;
      padding-bottom: 0.5rem;
    }
    .timestamp {
      font-size: 0.8em;
      color: #77ff77;
    }
    #secret {
      display: none;
      color: yellow;
      font-weight: bold;
      margin-top: 2rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>üïπÔ∏è Retro Message Board</h1>

  <div id="inputArea">
    <input id="messageInput" type="text" placeholder="Type your message..." autocomplete="off" />
    <button onclick="postUserMessage()">Post Message</button>
    <button onclick="deleteAllUserMessages()">Delete All Messages</button>
  </div>

  <div id="messages"></div>

  <div id="secret">üëÄ You found the hidden truth‚Ä¶</div>

  <!-- Socket.io client library -->
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script>
    // Connect to your backend Socket.io server
    const socket = io('http://localhost:3000'); // Change URL if deployed

    const messagesDiv = document.getElementById('messages');
    const secretDiv = document.getElementById('secret');
    const input = document.getElementById('messageInput');

    // Add a message div to #messages
    function addMessageToPage(msg) {
      const msgEl = document.createElement('div');
      msgEl.className = 'message';
      const timeStr = new Date(msg.timestamp).toLocaleString();
      msgEl.innerHTML = `<strong>${msg.text}</strong><div class="timestamp">${timeStr}</div>`;
      messagesDiv.appendChild(msgEl);
      messagesDiv.scrollTop = messagesDiv.scrollHeight; // auto scroll to bottom
    }

    // Receive full chat history on connect
    socket.on('chat history', (messages) => {
      messagesDiv.innerHTML = ''; // clear old messages
      messages.forEach(addMessageToPage);
    });

    // Receive new messages live
    socket.on('new message', (msg) => {
      addMessageToPage(msg);
      if (msg.text === 'I know the secret') {
        secretDiv.style.display = 'block';
      }
    });

    // Send a new message to backend
    function sendMessage(text) {
      if (!text) return;
      const message = { text, timestamp: Date.now() };
      socket.emit('new message', message);
    }

    // Post message triggered by button or Enter key
    function postUserMessage() {
      const text = input.value.trim();
      if (text === '') return;
      sendMessage(text);
      input.value = '';
    }

    // Delete all messages in UI (backend clear not implemented here)
    function deleteAllUserMessages() {
      messagesDiv.innerHTML = '';
      secretDiv.style.display = 'none';
    }

    // Support pressing Enter to send message
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        postUserMessage();
      }
    });

    // Expose functions globally for buttons
    window.postUserMessage = postUserMessage;
    window.deleteAllUserMessages = deleteAllUserMessages;
  </script>
</body>
</html>
